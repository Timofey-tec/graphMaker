GraphMaker — визуализация зависимостей пакетов Alpine Linux

GraphMaker — это инструмент командной строки для анализа и визуализации зависимостей пакетов Alpine Linux (APK) без использования сторонних менеджеров пакетов. Программа поддерживает загрузку репозитория, построение графа зависимостей, поиск обратных зависимостей и визуализацию в формате SVG и ASCII-дерева.

Этап 1. Конфигурация

Программа использует файл config.toml для настройки параметров:

package_name — имя анализируемого пакета

repo_path — URL репозитория или путь к локальному/test файлу

repo_mode — режим работы: remote (удалённый репозиторий), local (локальный APKINDEX), test (тестовый файл с графом зависимостей)

output_file — имя файла для сохранения графа

ascii_mode — вывод зависимостей в виде ASCII-дерева (true/false)

max_depth — максимальная глубина анализа зависимостей

filter_substring — подстрока для фильтрации пакетов

Программа загружает конфигурацию и проверяет корректность всех параметров. В случае ошибки выводится информативное сообщение.

Этап 2. Получение данных о зависимостях

Программа скачивает или открывает локальный файл APKINDEX.

В режиме remote выполняется загрузка APKINDEX с репозитория через HTTPS. Для macOS/Windows SSL-проверка автоматически отключается, чтобы избежать ошибок.

В режиме local используется локальный APKINDEX.

В режиме test используется текстовый файл с графом зависимостей, где пакеты обозначены большими буквами.

Программа парсит APKINDEX и извлекает прямые зависимости заданного пакета.

Этап 3. Построение графа зависимостей (BFS)

Граф зависимостей строится алгоритмом BFS без рекурсии с учётом следующих правил:

Максимальная глубина обхода (max_depth)

Исключение пакетов, содержащих filter_substring

Обработка циклических зависимостей

Функция get_all_dependencies_bfs возвращает словарь, где ключ — пакет, а значение — список его зависимостей.

Этап 4. Обратные зависимости

Программа строит обратный граф зависимостей, где ключ — пакет, а значение — список пакетов, которые от него зависят.

Функция print_reverse_deps выводит на экран все пакеты, которые зависят от заданного пакета.

Этап 5. Визуализация

GraphMaker поддерживает два режима визуализации:

Graphviz (SVG)

Функция generate_dot формирует граф в формате DOT

Функция save_graph_svg сохраняет изображение в формате SVG через Graphviz (dot)

ASCII-дерево

Функция print_ascii_tree выводит зависимости в консоль в виде дерева

Включается через параметр ascii_mode = true в config.toml

Для работы визуализации Graphviz (dot) должен быть установлен на системе.

Основные функции программы

load_config(path) — загрузка конфигурации из TOML

validate_config(cfg) — проверка корректности параметров

download_apk_index(repo_path, repo_mode) — скачивание или открытие APKINDEX

parse_apk_index(index_path, package_name, test_mode=False) — получение прямых зависимостей

get_all_dependencies_bfs(root_pkg, index_path, max_depth, filter_substring, test_mode) — построение графа BFS

get_reverse_dependencies(graph) — построение обратного графа зависимостей

print_reverse_deps(reverse_graph, target) — вывод обратных зависимостей

generate_dot(graph) — генерация DOT-файла для Graphviz

save_graph_svg(dot_str, output_file) — сохранение графа в SVG

print_ascii_tree(graph, root, prefix="") — вывод ASCII-дерева зависимостей